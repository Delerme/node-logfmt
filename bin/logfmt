#! /usr/bin/env node

var logfmt = require('../logfmt')
var split = require('split')
var through = require('through')
process.stdin.setEncoding('utf8');

var argv = process.argv.slice(2);

if(argv[0] == '-r'){
  //reverse -- convert json to logfmt logs
  var println = function(line) {
    if(!line) return;
    logfmt.log(JSON.parse(line.trim()))
  }

  process.stdin
    .pipe(split())
    .pipe(through(println))

} else {

  var toJSON = through(
    function(obj){
      this.queue(JSON.stringify(obj) + "\n")
    },
    function() { this.queue(null) }
  )

  process.stdin
    .pipe(logfmt.streamParser())
    .pipe(toJSON)
    .pipe(process.stdout)
}

